---
- name: Check ign.com with the URI module
  hosts: test_nodes
  become: yes # Needed for firewalld module

  tasks:
    - name: Gathering Facts
      ansible.builtin.setup:

    - name: Debug Ansible Python Interpreter
      ansible.builtin.command: /usr/bin/python3 -c "import sys; print(sys.executable)"
      register: python_interpreter_path
      changed_when: false # Prevent this debug task from showing 'changed'

    - name: Display Python interpreter path
      ansible.builtin.debug:
        msg: "Ansible is attempting to use Python: {{ python_interpreter_path.stdout }}"

    - name: Add rich rules to firewalld and reload
      ansible.posix.firewalld:
        zone: public # IMPORTANT: Confirm this is the correct zone
        permanent: true
        immediate: true # Applies the rule without a full reload, usually faster
        rich_rule: "{{ item }}"
        state: present # This parameter applies to the rich_rule defined by 'item'
      loop:
        - 'rule family="ipv4" destination address="0.0.0.0/0" port port="80" protocol="tcp" drop'
        - 'rule family="ipv4" destination address="0.0.0.0/0" port port="443" protocol="tcp" drop'
        - 'rule family="ipv6" destination address="::/0" port port="80" protocol="tcp" drop'
        - 'rule family="ipv6" destination address="::/0" port port="443" protocol="tcp" drop'