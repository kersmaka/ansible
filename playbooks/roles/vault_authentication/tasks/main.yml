- name: Get the Krabby Patty Secret Formula From Hasicorp Vault
  vars:  # vars is at the role level, BEFORE tasks
    vault_token: hvs.4icVDQC4UHjq3iTE0A8d52kO  # Your token
  tasks:  # Tasks section starts here

    - name: Get a Vault secret via the API
      ansible.builtin.uri:
        url: "https://10.0.0.33:8200/v1/secret-recipes/data/krabby-patty"
        validate_certs: false  # In production, use proper certificate validation
        method: GET
        headers:
          X-Vault-Token: "{{ vault_token }}"
        # body: '{"data":{"key":"value"}}'  # GET request should not have a body
        # body_format: json  # No body
        return_content: yes
      register: response

    - name: Set kerberos_password fact
      ansible.builtin.set_fact:
        kerberos_password: "{{ response.json.data.data.formula }}"

    - name: Display the results (optional)
      ansible.builtin.debug:
        msg: "Kerberos Password: {{ kerberos_password }}"